<!--Navbar -->
<nav class="mb-1 navbar navbar-expand-sm navbar-light white">
  <!-- SideNav slide-out button -->
  <a href="#" data-activates="slide-out" class="disappear-with-sidebar text-navy p-3 button-collapse">
    <i class="fas fa-bars"></i>
  </a>

  <%= link_to root_path, class: "navbar-brand py-1" do %>
    <%= image_tag "logo_words.png", style: "height: 35px; width: auto" %>
  <% end %>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-4"
    aria-controls="navbarSupportedContent-4" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent-4">
    <ul class="navbar-nav ml-auto">


      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          How To</a>
        <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
          <%= link_to "Buy a House", page_path("buy"), class: "dropdown-item", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Buy a House'})" %>
          <%= link_to "Rent a House", page_path("rent"), class: "dropdown-item", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Rent a House'})" %>
          <%= link_to "Sell My House", page_path("sell"), class: "dropdown-item sell", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Sell a House'})" %>
          <%= link_to "Get a Loan", page_path("loan"), class: "dropdown-item loan", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Get a Loan'})" %>
          <%= link_to "Refinance My Mortgage", page_path("mortgage"), class: "dropdown-item refinance", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Refinance'})" %>
          <%= link_to "For Realtors: Build My Business", page_path("agents"), class: "dropdown-item agent", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav For Agents'})" %>
        </div>
      </li>

      <li class="nav-item">
        <%= link_to "Blog", blogs_path, class: "nav-link" %>
      </li>


      <li class="nav-item">
        <%= link_to "Contact Me", new_contact_path, class: "nav-link" %>
      </li>


      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false">
          Resources</a>
        <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
          <%= link_to "Printable Resources", resources_path, class: "dropdown-item", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Downloadable Resources'})" %>
          <%= link_to "Market Updates", updates_path, class: "dropdown-item", onclick: "ga('send',{'hitType': 'event','eventCategory': 'nav', 'eventAction': 'Click Main Nav Housing Market Updates'})" %>
        </div>
      </li>

      <!-- ADMIN DASHBOARD -->
      <% if current_user && current_user.admin %>
        <li class="nav-item dropdown">
          <%= link_to "<i class='fas fa-user-shield mr-1'></i>Admin".html_safe, admin_dashboard_path, class: "nav-link dropdown-toggle", id: "navbarDropdownMenuLink-4", data: { toggle: "dropdown" },
            aria: { haspopup: "true", expanded: "false" } %>
          <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
            <%= link_to "Admin Dashboard", admin_dashboard_path, class: "dropdown-item" %>
            <%= link_to "All Loans (#{ Loan.where(active: true).count })", admin_loans_path, class: "dropdown-item" %>
            <%= link_to "All Documents (#{ Document.all.count })", admin_documents_path, class: "dropdown-item" %>
            <%= link_to "All Clients (#{ User.where(current_client: true).count })", admin_clients_path, class: "dropdown-item" %>
            <%#= link_to "Blog Manager", admin_blogs_path, class: "dropdown-item" %>
          </div>
        </li>
      <% end %>
      <!-- ADMIN DASHBOARD -->


      <% visible_loans = [] %>
      <% Loan.where(active: true).each do |loan| %>
        <% if loan.user != nil && ( current_user.user_ids.include? loan.user_id ) %> 
          <% visible_loans << loan %>
        <% end %>
      <% end %>

      <% visible_docs = [] %>
      <% Document.all.each do |doc| %>
        <% if doc.user != nil && ( current_user.user_ids.include? doc.user_id ) %> 
          <% visible_docs << doc %>
        <% end %>
      <% end %>

      <% visible_clients = [] %>
      <% User.where(current_client: true).each do |client| %>
        <% if current_user.user_ids.include? client.id %> 
          <% visible_clients << client %>
        <% end %>
      <% end %>

      <!-- TEAM DASHBOARD -->
      <% if current_user && current_user.team %>
        <li class="nav-item dropdown">
          <%= link_to "<i class='fas fa-user-tie mr-1'></i>Team".html_safe, team_dashboard_path, class: "nav-link dropdown-toggle", id: "navbarDropdownMenuLink-4", data: { toggle: "dropdown" },
            aria: { haspopup: "true", expanded: "false" } %>
          <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
            <%= link_to "Team Dashboard", team_dashboard_path, class: "dropdown-item" %>
            <% if visible_loans.count != 0 %>
              <%= link_to "Client Loans (#{ visible_loans.count })", team_loans_path, class: "dropdown-item" %>
            <% end %>
            <% if visible_loans.count != 0 %>
              <%= link_to "Client Documents (#{ visible_docs.count })", team_documents_path, class: "dropdown-item" %>
            <% end %>
            <% if visible_clients.count != 0 %>
              <%= link_to "My Clients (#{ visible_clients.count })", team_clients_path, class: "dropdown-item" %>
            <% end %>
          </div>
        </li>
      <% end %>
      <!-- TEAM DASHBOARD -->


      <!-- USER DASHBOARD -->
      <% if current_user %>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-user mr-1"></i><%= current_user.first_name %>'s Portal</a>
          <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
            <%= link_to 'My Documents', documents_path, class: "dropdown-item" %>           
            <% Loan.where(user_id: current_user.id).each do |loan| %>
              <%= link_to loan.first_payment.year.to_s + " " + loan.program + " Loan", loan_path(loan), class: "dropdown-item" %>
            <% end %>
            <%= link_to 'My Portal', user_path(current_user), class: "dropdown-item" %>
            <%= link_to 'Sign Out', destroy_user_session_path, method: :delete, class: "dropdown-item" %>
          </div>
        </li>
      <% else %>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            My Account</a>
          <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
            <%= link_to 'Create an Account', new_user_registration_path, class: "dropdown-item" %>
            <%= link_to 'Sign In', new_user_session_path, class: "dropdown-item" %>
          </div>
        </li>
      <% end %>
      <!-- USER DASHBOARD -->


    </ul>
  </div>

</nav>
<!--/.Navbar -->
